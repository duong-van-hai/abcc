<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>AR Pokemon Hand</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <video id="webcam" style="position: absolute; width: 100%; height: 100%; object-fit: cover; z-index: -1; transform: scaleX(-1);" autoplay playsinline></video>

    <a-scene embedded vr-mode-ui="enabled: false" renderer="alpha: true;">
        <a-entity id="pokemon" visible="false">
            <a-sphere radius="0.25" color="#FFFF00" position="0 0 0"></a-sphere>
            <a-cone radius-bottom="0.05" height="0.3" color="#FFFF00" position="-0.15 0.25 0" rotation="0 0 20">
                <a-sphere radius="0.02" color="#000" position="0 0.15 0"></a-sphere>
            </a-cone>
            <a-cone radius-bottom="0.05" height="0.3" color="#FFFF00" position="0.15 0.25 0" rotation="0 0 -20">
                <a-sphere radius="0.02" color="#000" position="0 0.15 0"></a-sphere>
            </a-cone>
            <a-sphere radius="0.02" color="#000" position="-0.08 0.05 0.2"></a-sphere>
            <a-sphere radius="0.02" color="#000" position="0.08 0.05 0.2"></a-sphere>
            <a-sphere radius="0.04" color="#FF0000" position="-0.15 -0.05 0.18"></a-sphere>
            <a-sphere radius="0.04" color="#FF0000" position="0.15 -0.05 0.18"></a-sphere>
            <a-box width="0.05" height="0.3" depth="0.02" color="#FFFF00" position="0 0 -0.25" rotation="0 0 45"></a-box>
        </a-entity>

        <a-entity light="type: ambient; intensity: 1.5"></a-entity>
        <a-entity camera position="0 1.6 0"></a-entity>
    </a-scene>

    <script>
        const videoElement = document.getElementById('webcam');
        const pokemon = document.getElementById('pokemon');

        const hands = new Hands({
            locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
        });

        hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.7, minTrackingConfidence: 0.7 });

        hands.onResults((results) => {
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                pokemon.setAttribute('visible', 'true');
                const palm = results.multiHandLandmarks[0][9]; // Lòng bàn tay
                const x = (0.5 - palm.x) * 4;
                const y = (0.5 - palm.y) * 3 + 1.5;
                const z = -2 + (palm.z * 2);
                pokemon.setAttribute('position', {x, y, z});
                pokemon.setAttribute('rotation', `0 ${x * 40} 0`);
            } else {
                pokemon.setAttribute('visible', 'false');
            }
        });

        const camera = new Camera(videoElement, {
            onFrame: async () => { await hands.send({image: videoElement}); },
            width: 1280, height: 720
        });
        camera.start();
    </script>
</body>
</html>